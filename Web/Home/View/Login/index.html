<!DOCTYPE html>
<!--[if IE 9 ]><html class="ie9"><![endif]-->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
        <meta name="format-detection" content="telephone=no">
        <meta charset="UTF-8">

        <meta name="description" content="Violate Responsive Admin Template">
        <meta name="keywords" content="Super Admin, Admin, Template, Bootstrap">

        <title>高校网络舆情分析平台</title>
            
        <!-- CSS -->
        <link href="{$webroot}assets/css/bootstrap.min.css" rel="stylesheet">
        <link href="{$webroot}assets/css/form.css" rel="stylesheet">
        <link href="{$webroot}assets/css/style.css" rel="stylesheet">
        <link href="{$webroot}assets/css/animate.css" rel="stylesheet">
        <link href="{$webroot}assets/css/generics.css" rel="stylesheet"> 
        <link rel="stylesheet" href="{$webroot}assets/css/jquery.gritter.css" />
    </head>
    <body id="skin-blur-chrome">
        <section id="login">
            <header style="text-align: center;">
                <h2> 高校网络舆情分析平台 </h2>
                <p> 1.0: 舆情监测、舆情预警、舆情报告。 </p>
            </header>
        
            <div class="clearfix"></div>
            <section id="main" class="p-relative" role="main">
            <!-- Content -->
            <section id="content" class="container" style="margin-left: 0">
                <div class="col-md-offset-4 col-md-4 col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-10" style="padding-left: 0;">
                    <!-- Login -->
                    <div class="box tile animated active" id="box-login">
                        <h2 class="m-t-0 m-b-15"> 登录 </h2>
                        <input type="text" class="login-control m-b-10" id="login_phone_number" placeholder="用户名">
                        <input type="password" class="login-control" id="login_password" placeholder="密码">
                        <div class="checkbox m-b-20">
                            <!--label>
                                <input type="checkbox">
                                记住我
                            </label-->
                        </div>
                        <button class="btn btn-sm m-r-5 pull-right" onClick="clickLogin();"> 登入 </button>
                        
                        <!--small>
                            <a class="box-switcher" data-switch="box-register" href="">Don't have an Account?</a> or
                            <a class="box-switcher" data-switch="box-reset" href="">Forgot Password?</a>
                        </small-->
                    </div>
            
                </div>
            </div>
            
            <!-- Register -->
            <form class="box animated tile" id="box-register">
                <h2 class="m-t-0 m-b-15">Register</h2>
                <input type="text" class="login-control m-b-10" placeholder="Full Name">
                <input type="text" class="login-control m-b-10" placeholder="Username">
                <input type="email" class="login-control m-b-10" placeholder="Email Address">    
                <input type="password" class="login-control m-b-10" placeholder="Password">
                <input type="password" class="login-control m-b-20" placeholder="Confirm Password">

                <button class="btn btn-sm m-r-5">Register</button>

                <small><a class="box-switcher" data-switch="box-login" href="">Already have an Account?</a></small>
            </form>
            
            <!-- Forgot Password -->
            <form class="box animated tile" id="box-reset">
                <h2 class="m-t-0 m-b-15">Reset Password</h2>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla eu risus. Curabitur commodo lorem fringilla enim feugiat commodo sed ac lacus.</p>
                <input type="email" class="login-control m-b-20" placeholder="Email Address">    

                <button class="btn btn-sm m-r-5">Reset Password</button>

                <small><a class="box-switcher" data-switch="box-login" href="">Already have an Account?</a></small>
            </form>
        </section>                      
        
        <!-- Javascript Libraries -->
        <!-- jQuery -->
        <script src="{$webroot}assets/js/jquery.min.js"></script> <!-- jQuery Library -->
        
        <!-- Bootstrap -->
        <script src="{$webroot}assets/js/bootstrap.min.js"></script>
        
        <!--  Form Related -->
        <script src="{$webroot}assets/js/icheck.js"></script> <!-- Custom Checkbox + Radio -->
        
        <!-- All JS functions -->
        <script src="{$webroot}assets/js/functions.js"></script>
        <script src="{$webroot}assets/js/md5.js"></script>
        <script src="{$webroot}assets/js/jquery.gritter.min.js"></script>
        
    <script type="text/javascript">
    var toUN = {
        on: function(str) {
            var a = [],
            i = 0;
            for (; i < str.length;) a[i] = ("00" + str.charCodeAt(i++).toString(16)).slice( - 4);
            return "\\u" + a.join("\\u")
        },
        un: function(str) {
            return unescape(str.replace(/\\/g, "%"))
        }
    };
        
    jQuery.setCookie = function (sName, sValue, oExpires, sPath, sDomain, bSecure) {  
      var sCookie = sName + '=' + encodeURIComponent(sValue);  
      if (oExpires) {  
          sCookie += '; expires=' + oExpires.toGMTString();  
      };  
      if (sPath) {  
          sCookie += '; path=' + sPath;  
      };  
      if (sDomain) {  
          sCookie += '; domain=' + sDomain;  
      };  
      if (bSecure) {  
          sCookie += '; secure';  
      };  
      document.cookie = sCookie;  
    };  
          
    jQuery.getCookie = function (sName) {  
        var sRE = '(?:; )?' + sName + '=([^;]*)';  
        var oRE = new RegExp(sRE);  
        if (oRE.test(document.cookie)) {  
            return decodeURIComponent(RegExp['$1']);  
        } else {  
            return null;  
        };  
    }  
      
    jQuery.deleteCookie = function (sName, sPath, sDomain) {  
        this.setCookie(sName, '', new Date(0), sPath, sDomain);  
    }
        
    jQuery(document).ready(function(){
        impletePlaceholder();
    });
            
    var placeholder = function(input){
        var text=input.getAttribute('placeholder'), defaultValue=input.defaultValue;
        if(defaultValue==''){input.value=text;}
        input.onfocus=function(){
          if(input.value===text){this.value='';}
          if(input.id.indexOf('password') > -1){
            input.type = 'password';
          }
        };
        input.onblur=function(){
          if(input.value===''){
            input.type = 'text';
            this.value=text;
          }
        };
    };
      
    function impletePlaceholder(){
        var doc=document,inputs=doc.getElementsByTagName('input'),supportPlaceholder='placeholder' in doc.createElement('input');
        
        for(var i=0,len=inputs.length;i<len;i++){
          var input=inputs[i];
          input.onkeydown=function(){
            if (event.keyCode == 13){
              event.returnValue=false;
              event.cancel = true;
			  clickLogin();
              //alert(this.id.indexOf('login_') == 0);
              return;
            }
        
            if(event.keyCode == 8 && this.value.length < 2 && !supportPlaceholder){
              this.type = 'text';
              this.value=this.getAttribute('placeholder');
              this.blur();
              event.returnValue=false;
              event.cancel = true;
              return;
            }
          };
        }
        
        if(!supportPlaceholder){
          for(var i=0,len=inputs.length;i<len;i++){
            var input=inputs[i],text=input.getAttribute('placeholder');
            if(input.type==='text'&&text){placeholder(input);}
            if(input.type==='password'&&text&&(input.value==text||input.value=='')){
                input.type = 'text';
                placeholder(input);
            }
          }
        }
    }
      
    function resetInputs(_prefix) {
        var doc=document,inputs=doc.getElementsByTagName('input'),supportPlaceholder='placeholder' in doc.createElement('input');
          
        for(var i=0,len=inputs.length;i<len;i++){
            var input=inputs[i];
            if(input.id.indexOf(_prefix) == 0){
                input.value = '';
                if(!supportPlaceholder){
                    input.type = 'text';
                    input.value=input.getAttribute('placeholder');
                }
            }
        }
    }
      
    function clickLogin(){
        if($("#login_phone_number").val() == "" || $("#login_password").val() == "") {
            showUiResult("请输入完整信息","登录号与密码不能为空");
            return;
        }
        var url = '{$webroot}login/api_login_by_login_name';
        var postData = Object();
        postData.phone = $("#login_phone_number").val();
        postData.password = faultylabs.MD5($("#login_password").val());
        
        $.post(url, postData,
        function(data){
            var jsonObj = eval("("+data+")");
            if(jsonObj.state == 200){
                $.deleteCookie("authKey");
                $.setCookie("authKey",jsonObj.authKey);
                
                $('<form class="hide" />')
                .appendTo('body').attr({'method': 'POST', 'action': jsonObj.goPage}).submit();
            }else showUiResult(jsonObj.title,jsonObj.comment);
        },"text");
    }
      
    function clickReg(){
        var postData = Object();
        postData.phone = $.trim($("#reg_phone").val());
        var psw = $.trim($("#reg_password").val());
        var rePasswd = $.trim($("#reg_reType_password").val());
        postData.password = faultylabs.MD5(psw);
        
        if(postData.phone == "" || psw == "" || rePasswd == "") {
            showUiResult("请输入完整信息","输入框不能为空");
            return;
        }
        
        if(psw.length < 6){
            showUiResult("请输入正确信息","密码长度须大于6位数");
            return;
        }
        
        if(psw != rePasswd){
            showUiResult("请输入正确信息","重复输入密码不正确");
            return;
        }
        
        if($("#reg-accept").prop("checked") == false){
            showUiResult("提示信息","未接受用户条款");
            return;
        }
        
        if(!isPhoneNumber(postData.phone)) {
            showUiResult("请输入正确信息","手机号码格式不对");
            return;
        }
        
        var url = '{$webroot}reg/api_reg';
        
        $.post(url, postData,
        function(data){
          var jsonObj = eval("("+data+")");
          if(jsonObj.state == 200){
                $.deleteCookie("authKey");
                showUiResult(jsonObj.title,jsonObj.comment);
                $("#login_phone_number").val($("#reg_phone").val());
                $("#login_password").val($("#reg_password").val());
                show_box('login-box');
            }else showUiResult(jsonObj.title,jsonObj.comment);
        },"text");
    }
      
    function isPhoneNumber(telNum){
        if(/^13\d{9}$/g.test(telNum)||(/^15\d{9}$/g.test(telNum))||(/^18[8,9]\d{8}$/g.test(telNum))) return true;
        else return false;
    }
      
    function isFloat(values){
        var intR = /^\d+$/;
        var floatR = /^\d+(\.\d+)?$/;
        if(intR.test(values) == true || floatR.test(values) == true) return true;
        else return false;
    }
          
    function show_box(id) {
        jQuery('.widget-box.visible').removeClass('visible');
        jQuery('#'+id).addClass('visible');
    }
      
    function showUiResult(title, content){
        $.gritter.add({title: title, text: content, class_name: 'gritter-success gritter-light' });
    }
    </script>
    </body>
</html>
