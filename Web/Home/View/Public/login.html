<layout name="framework_wx" /><!--rend--><script src="{$webroot}assets/js/md5.js"></script>
<section id="login-section" data-aside="menu" data-transition="slide">
    <header data-title="登录量化交易系统">
        <!--nav>
            <button data-view-section="back" data-icon="chevron-left"></button>
        </nav>
        <nav class="on-right">
            <button data-view-aside="boards" data-icon="camera-retro"></button>
        </nav-->
    </header>
    <article id="login-article" class="active indented scroll list">
        <div class="form">
            <input type="text" placeholder="量化交易系统用户名" class="border" id="username-input">
            <input type="password" placeholder="密码" class="border" id="password-input">
            <br /><br />
            <button class="anchor margin-bottom" onClick="login();" id="login-button">提交登录</button>
            <br /><br />
            <button class="anchor accept margin-bottom" id="reg-button">若无账号,请先绑定微信</button>
        </div>
    </article>
    <!--link rel="stylesheet" href="/assets/lungo.2.2.0/lungo.theme.css">
    <footer id="footer">
        <nav>
            <a href="#" data-icon="menu" class="active"></a>
            <a href="#" data-icon="share"></a>
            <a href="#" data-icon="user"></a>
            <a href="#" data-icon="share"></a>
        </nav>
    </footer-->
    
    <script>
        function login(){
            disableAll();
            
            var user = $$("#username-input").val();
            var pass = $$("#password-input").val();
            
            if(user == ""){
                drawToast("用户名不能为空",0);
                enableAll();
                return;
            }
            
            if(pass == ""){
                drawToast("密码不能为空",0);
                enableAll();
                return;
            }
            
            var md5pass = faultylabs.MD5(pass);
            
            var url = "{$webroot}stock/api_login";
            var data = {user: user, pass: md5pass};
            var parseResponse = function(result){
                drawToast(result.title,0);
                if(result.state == 200){
                    openId = result.openId;
                    setCookie("openid",openId);
                    Lungo.Router.back();
                }else enableAll();
            };
            Lungo.Service.post(url, data, parseResponse, "json");
            
            drawToast("登录中...");
        }
        
        function disableAll(){
            $$("#username-input").attr("disabled",true);
            $$("#password-input").attr("disabled",true);
            $$("#login-button").attr("disabled",true);
            $$("#reg-button").addClass("hidden");
        }
        
        function enableAll(){
            $$("#username-input").removeAttr("disabled");
            $$("#password-input").removeAttr("disabled");
            $$("#login-button").removeAttr("disabled");
            $$("#reg-button").removeClass("hidden");
        }
    </script>
</section>
