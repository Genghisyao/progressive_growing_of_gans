<!DOCTYPE html>
<!--[if IE 9 ]>
<html class="ie9">
<![endif]-->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
        <meta name="format-detection" content="telephone=no">
        <meta charset="UTF-8">

        <meta name="description" content="Violate Responsive Admin Template">
        <meta name="keywords" content="Super Admin, Admin, Template, Bootstrap">

        <title>信号分析</title>
            
        <!-- CSS -->
        
        <link href="{$webroot}assets/css/animate.min.css" rel="stylesheet">
        <link href="{$webroot}assets/css/font-awesome.min.css" rel="stylesheet">
        <!-- <link href="{$webroot}assets/css/form.css" rel="stylesheet"> -->

        <link href="{$webroot}assets/css/file-manager.css" rel="stylesheet">
        <link href="{$webroot}assets/css/style.css" rel="stylesheet">
        <link href="{$webroot}assets/css/icons.css" rel="stylesheet">
        <link href="{$webroot}assets/css/generics.css" rel="stylesheet">
        <link href="{$webroot}assets/css/bootstrap.min.css" rel="stylesheet">
        <link href="{$webroot}assets/css/jquery.dataTables.css" rel="stylesheet">
        <style type="text/css">
          .content{width: 100%;height: 100%;padding: 10px;}
          .markTable{width: 100%;height: 100%;background-color: #fff;border:1px solid #ddd;border-radius: 5px!important;padding:5px;}
          table{width: 100%;margin: 0px!important;}
          body *{color: #666;}
          .tableBody{overflow: auto;}
          #myModal .modal-body{height: 400px;overflow: auto;}
          .tableHead td{font-weight: 700;font-size: 16px;}
          label{padding: 0px 5px;}
          td{font-weight: 700;}
          a{color: #2a6496;}
          .chooseBox{color: red;}
          .tableBody table{table-layout: fixed;}
          .ellipsisTd{text-overflow: ellipsis;-moz-text-overflow: ellipsis;overflow: hidden;white-space:nowrap;}
          .saveBtn span{font-weight: 700;color: #435f76;padding: 0px 10px;}
        </style>

    </head>
    
    <body style="background-color: rgba(255, 255, 255, 0);" id="skin-blur-white">
      <div class="content">
        <div class="markTable">
          <div class="saveBtn text-right"><span id="nowAmount">147</span>/<span id="totalAmount">147</span><button class="btn btn-primary" onclick="save();">保存</button></div>
          <div class="dataTable">
            <div class="tableHead">
              <table class="table">
                <tr>
                  <td>标题</td>
                  <td>内容</td>
                  <td class="text-center">操作</td>
                </tr>
              </table>
            </div>
            <div class="tableBody">
              <table class="table table-striped table-hover">
                <!-- <tr>
                  <td class="title" style="width: 30%">中山限外令</td>
                  <td style="width:40%;" class="ellipsisTd" name="0" onclick="checkArticle(this)">中山大学曹永长教授团队发现一种新的冠状病毒引起仔猪腹泻_中国同心相随志愿者发展中心 近日，中山大学有害生物控制与资源利用国家重点实验室曹永长教授团队发现了一种能够引起仔猪腹泻，对新生仔猪具有高致死性，对生产造成严重危害的新的冠状病毒。相关研究成果 网页链接.</td>
                  <td class="text-center" style="width: 30%;">
                    <label>
                      <input type="radio" name="1">正面
                    </label>
                    <label>
                      <input type="radio" name="1">中立
                    </label>
                    <label>
                      <input type="radio" name="1">负面
                    </label>
                  </td>
                </tr> -->
                
              </table>
            </div>
          </div>
        </div>
      </div>
        <!-- Javascript Libraries -->
        <!-- jQuery -->
        <script src="{$webroot}assets/js/jquery.min.js"></script> <!-- jQuery Library -->
        <script src="{$webroot}assets/js/jquery-ui.min.js"></script> <!-- jQuery UI -->
        
        <!-- Bootstrap -->
        <script src="{$webroot}assets/js/bootstrap.min.js"></script>
        
        
        <!-- UX -->
        <script src="{$webroot}assets/js/scroll.min.js"></script> <!-- Custom Scrollbar -->
        <script src="{$webroot}assets/js/jquery.dataTables.min.js"></script>   <!-- datatables -->
        
        <!-- All JS functions -->

        <script type="text/javascript">
          window.onload=function(){

            $(".dataTable").height($(".markTable").height()-$(".saveBtn").height());
            $(".tableBody").height($(".dataTable").height()-$(".tableHead").height());
            getData();
            checkArticle();
            

            
          }
          var resultData;
          //初始化列表
          function getData(){
            $.ajax({
              url:'/label/api_get_article_nature',
              dataType:'json',
              type:'post',
              success:function(result){
                console.log(result);
                resultData=result;
                if (result.total_count>100) {
                  $("#totalAmount").html(result.total_count);
                  $("#nowAmount").html("100");
                }else{
                  $("#totalAmount").html(result.total_count);
                  $("#nowAmount").html(result.total_count);
                }
                var result=result.result;
                var str='';
                for(var i=0;i<result.length;i++){
                  var id=result[i].channel+';'+result[i].event_id+';'+result[i].tid;
                  
                  var title=result[i].title;
                  str+='<tr id='+id+'><td class="title" style="width:30%;">'+title+'</td><td style="width:40%;"  href="#" class="ellipsisTd" name="0" onclick="checkArticle(this);" name="'+i+'">'+result[i].content+'</td><td style="width:30%;" class="text-center"><label><input type="radio" name="'+i+'">正面</label><label><input type="radio" name="'+i+'">中立</label><label><input type="radio" name="'+i+'">负面</label></td></tr>';
                }
                $(".tableBody table").empty();
                $(".tableBody table").append(str);
                var tdLength=$(".tableHead td").length;
                for(var i=0;i<tdLength;i++){
                  $(".tableHead td").eq(i).width($(".tableBody tr").eq(0).find("td").eq(i).width());
                }

              }
            })
          }

          //询问是否保存
          function save(){
            
            /*if(window.confirm("是否要保存？")){*/
              var postData=[];
              var count=0;
              var disFinish=resultData.total_count;
              var tr=$(".tableBody table tr");
              for(var i=0;i<tr.length;i++){
                var inputRadio=tr.eq(i).find("td").eq(2).find("input");
                if (inputRadio.eq(0).is(':checked')||inputRadio.eq(1).is(':checked')||inputRadio.eq(2).is(':checked')) {
                  var obj={};
                  var idArray=tr.eq(i).attr("id").split(";");
                  obj.channel=idArray[0];
                  obj.event_id=idArray[1];
                  obj.tid=idArray[2];
                  if (inputRadio.eq(0).is(':checked')) {
                    obj.article_nature="positive";
                  }else if(inputRadio.eq(1).is(':checked')){
                    obj.article_nature="neutral";
                  }else{
                    obj.article_nature="negative";
                  }
                  postData.push(obj);
                  count++;
                  disFinish--;
                }else{
                  /*alert("no");*/
                }
              }
              console.log(postData);
              if(window.confirm("您成功填写了"+count+"项。剩余"+disFinish+"项。是否要保存？")){
                if(postData.length!=0){
                   $.ajax({
                    url:"/label/api_set_article_nature",
                    data:{data:postData},
                    dataType:'json',
                    type:'post',
                    success:function(result){
                    }
                  })
                 }else{
                  alert("保存失败，不能传输空白内容。");
                 }
                getData();
                
              }else{

              }
              
            /*}else{
             
            }*/
            
          }

          //查看原文
          function checkArticle(item){
            if ($(item).attr("name")==0) {
              $(item).removeClass("ellipsisTd");
              $(item).attr("name",1);
            }else{
              $(item).addClass("ellipsisTd");
              $(item).attr("name",0);
            }
            
          }

        </script>
    </body>
</html>

