<!DOCTYPE html>
<!--[if IE 9 ]>
<html class="ie9">
<![endif]-->

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="format-detection" content="telephone=no">
    <meta charset="UTF-8">
    <meta name="description" content="Violate Responsive Admin Template">
    <meta name="keywords" content="Super Admin, Admin, Template, Bootstrap">
    <title>文件管理</title>
    <!-- CSS -->
    <link href="{$webroot}assets/css/animate.min.css" rel="stylesheet">
    <link href="{$webroot}assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="{$webroot}assets/css/form.css" rel="stylesheet">
    <link href="{$webroot}assets/css/style.css" rel="stylesheet">
    <link href="{$webroot}assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="{$webroot}assets/css/icons.css" rel="stylesheet">
    <link href="{$webroot}assets/css/generics.css" rel="stylesheet">
    <link href="{$webroot}assets/css/timeline.css" rel="stylesheet">
    <link href="{$webroot}assets/css/fonts/font.default.css" rel="stylesheet">
    <link href="{$webroot}assets/css/jquery.dataTables.css" rel="stylesheet">
    <style type="text/css">
    #content {
        margin-left: 0
    }

    .widgets-margin {
        margin: 8px 5px 5px 12px;
    }

    .listview.narrow .media {
        padding: 0 0 0 10px;
    }

    .h6 {
        margin-top: 9px;
    }

    .listview .counts {
        color: rgba(255, 255, 255, 0.8);
    }

    td {
        overflow: hidden;
    }
    /* 设置滚动条的样式 */

     ::-webkit-scrollbar {
        background-color: rgba(0, 0, 0, 0.5);
        width: 12px;
    }
    /* 滚动槽 */

     ::-webkit-scrollbar-track {
        -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
        border-radius: 10px;
    }
    /* 滚动条滑块 */

     ::-webkit-scrollbar-thumb {
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.5);
        -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.5);
    }

     ::-webkit-scrollbar-thumb:window-inactive {
        background: rgba(255, 0, 0, 0.4);
    }

    .table-bordered>tfoot>tr>td {
        border: 1px solid #ddd;
        border-left-style: none;
        border-right-style: none;
    }

    .table>tfoot>tr>td {
        padding: 2px 12px 2px 8px;
    }

    .no-margin {
        margin: 0
    }

    .table-margin {
        margin: -28px 0 0 0;
    }

    @media (min-width: 992px) {
        /*
               .data-body { 
                   display: block;  
                   overflow-y: scroll;  
               }
               .data-head, .data-body tr {  
                   display: table;
                   width:100%;
                   table-layout:fixed;
               }
               */
        #frame-left {
            padding-right: 0;
        }

        #frame-right {
            padding: 8px 12px 8px 8px;
        }
    }

    @media (max-width: 992px) {
        #frame-left {
            padding-right: 13px;
        }

        #frame-right {
            padding: 8px 18px 8px 19px;
        }
    }

    @media (max-width: 767px) {
        .table-responsive {
            margin-bottom: 0;
        }
    }

    thead th {
        overflow: hidden;
    }

    .scroll {
        overflow-x: hidden;
        overflow-y: scroll;
    }

    .no-scroll {
        overflow-x: hidden;
        overflow-y: hidden;
    }

    #setting-tbody input {
        border-style: None;
        padding: 0;
        height: 16px;
        border-right-style: dashed;
        border-color: green;
    }

    #setting-tbody td:nth-child(3) {
        color: gray;
    }

    .select-option option {
        background-color: gray;
    }

    #skin-blur-white .tab-container {
        border-style: none;
        background-color: #fff;
        color: #666;
    }

    #skin-blur-white .tab-container ul {
        background-color: #fff;
        background: rgba(0, 0, 0, 0) !important;
        border-bottom: 1px solid #ddd;
    }

    #skin-blur-white .tab-container ul a {
        color: #435f76;
        background-color: #fff;
        border-bottom: 1px solid #ddd;
    }

    #skin-blur-white .tab-container ul a :hover {
        background-color: rgba(0, 0, 0, 0)!important;
        color: #666;
        border-bottom: 1px solid #435f76;
    }

    #skin-blur-white .tab-container ul .active a {
        background: rgba(0, 0, 0, 0) !important;
        border-bottom: 1px solid #435f76;
    }

    #skin-blur-white .form-control option {
        color: #666 !important;
        background-color: #fff;
    }

    #skin-blur-white .form-control {
        color: #666;
        background-color: #fff;
        border: 1px solid #ddd;
    }

    #skin-blur-white .block-title {
        background-color: #fff;
        color: #777;
        margin: 0px;
        transform: skewX(-10deg);
    }

    #skin-blur-white #model-init .btn-alt {
        border: 1px solid #ddd !important;
        background-color: #fff;
        color: #666;
        box-shadow: 0px 0px 3px rgb(67, 95, 118);
    }

    #skin-blur-white #math-comment {
        background-color: #eaeaea;
    }

    #skin-blur-white #model-setting .table th,
    #skin-blur-white #model-setting .table td {
        border-style: none;
    }

    #skin-blur-white #model-setting .table thead tr th {
        background-color: #fff;
        transform: scaleX(0.8);
        color: #000;
        font-size: 14px;
        /*font-weight: 600;*/
    }

    #skin-blur-white #model-setting .table tbody tr td {
        background-color: #fff;
    }

    #skin-blur-white #model-setting .table thead tr {
        border-bottom: 2px solid #ddd;
        background-color: #fff;
    }

    #skin-blur-white #model-setting .table tbody tr {
        border-top: 1px solid #ddd;
    }

    #skin-blur-white #model-result .table thead tr th {
        background-color: #fff;
        transform: scaleX(0.8);
        color: #000;
        font-size: 14px;
        border-style: none;
    }

    #skin-blur-white #model-result .tile {
        background: rgba(0, 0, 0, 0)!important;
    }

    #skin-blur-white #model-setting .tile {
        background: rgba(0, 0, 0, 0)!important;
    }

    #skin-blur-white #model-result .table tbody tr td {
        background-color: #fff;
        border-style: none;
    }

    #skin-blur-white #model-result .table tbody tr {
        border-top: 1px solid #ddd;
    }

    #skin-blur-white #model-result .table tbody tr:nth-child(1) {
        border-top: 2px solid #ddd;
    }

    #skin-blur-white b {
        color: #d74b4b!important;
    }

    #skin-blur-white #frame-right .tile {
        background-color: #fff;
        border: 1px solid #ddd;
    }

    #skin-blur-white #frame-right .tile th,
    #skin-blur-white #frame-right .tile td {
        background-color: #fff;
        color: #666;
        border-style: none;
    }

    #frame-right .tile thead p {
        white-space: nowrap;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        -moz-text-overflow: ellipsis !important;
        margin: 0px;
    }

    #data-header-table {
        /*border-bottom-style: none;*/
        table-layout: fixed !important;
    }
    /*#frame-right .tile td,#frame-right .tile th{
            border-style: none;
           }*/

    #skin-blur-white #frame-right .tile tbody tr:nth-child(odd) td {
        background-color: #eaeaea;
    }

    #skin-blur-white #frame-right .tile thead th {
        color: #435f76;
    }

    #skin-blur-white .pagination a:hover {
        background-color: #eaeaea !important;
    }

    #skin-blur-white select:not([multiple]) {
        background-image: url(../../../assets/img/select-bg-w.png);
        background-repeat: no-repeat;
        background-position: right center;
    }

    #skin-blur-white select:not([multiple]):focus {
        background-image: url(../../../assets/img/select-bg-w.png);
        background-repeat: no-repeat;
        background-position: right center;
    }

    #skin-blur-white #frame-left .widgets-margin {
        background-color: #fff;
        border: 1px solid #ddd;
    }

    #frame-left .tab-content {
        scroll-behavior: smooth;
        overflow-y: auto;
    }

    .form-control {
        scroll-behavior: smooth;
        overflow-y: auto;
    }

    #skin-blur-white #frame-left #model-setting .btn {
        box-shadow: 0px 0px 3px rgb(67, 95, 118);
        color: rgb(67, 95, 118);
        border: 1px solid #ddd !important;
    }

    #skin-blur-white #frame-left #model-result .btn {
        box-shadow: 0px 0px 3px rgb(67, 95, 118);
        color: rgb(67, 95, 118);
        border: 1px solid #ddd !important;
    }
    /*#skin-blur-white #frame-left #model-setting .btn,#skin-blur-white #frame-left #model-result .btn:hover{
            background-color: #eaeaea !important;
          }*/

    #skin-blur-white #data-table {
        border-top-style: none !important;
    }

    #skin-blur-white .table th,
    #skin-blur-white .tile {
        box-shadow: 0px 0px 0px rgba(0, 0, 0, 0);
    }
    /*舆论分析*/

    #skin-blur-white #main,
    #skin-blur-white #content,
    #skin-blur-white #contentDiv {
        height: 100% !important;
        width: 100%;
    }
    /*#skin-blur-white #contentDiv{
            height:auto!important;
           }*/

    #skin-blur-white #main {
        overflow: auto;
    }

    #skin-blur-white #content {
        padding: 10px !important;
    }

    #skin-blur-white #echartsShow {
        background-color: rgba(0, 0, 0, 0) !important;
        border-style: none;
    }

    #skin-blur-white #contentDiv {
        border: 1px solid #ddd;
        border-radius: 5px !important;
        background-color: #fff;
    }

    #skin-blur-white .titleDiv p {
        margin: 0px;
        color: #435f76;
        font-size: 18px;
        font-weight: 500;
        /*height: 30px;*/
        padding: 10px 20px 5px 0px;
        border-bottom: 1px solid #435f76;
        display: inline-block;

        font-family: '微软雅黑', 'open-sans-light', sans-serif;
    }

    #skin-blur-white .titleDiv {
        border-bottom: 1px solid #ddd;
        height: auto;
        padding-left: 20px;
    }

    #skin-blur-white #echartsShow {
        width: 100%;
    }

    #skin-blur-white .tl-slide-content-container .tl-headline {
        font-size: 16px;
        font-weight: 400;
        color: #666;
    }

    #skin-blur-white .tl-text-content .title {
        font-size: 18px;
        font-weight: 700;
        color: #666;
    }

    #skin-blur-white .tl-text-content .content {
        font-size: 14px;
        color: #666;
    }

    #skin-blur-white .tl-text-content a {
        color: #666;
        text-decoration: none;
        font-size: 12px;
        color: #435f76;
    }

    #skin-blur-white .tl-text-content a:hover {
        text-decoration: underline;
        color: #d74b4b;
    }

    #skin-blur-white .tl-timemarker-content-container {
        height: auto !important;
    }

    #skin-blur-white .tl-slide .tl-slide-scrollable-container {
        width: 100%;
    }

    #skin-blur-white .tl-slide .tl-slide-content-container {
        width: 100%;
    }

    #skin-blur-white .tl-slide-content {
        width: 100% !important;
    }

    #skin-blur-white .tl-slide-content-container {
        padding-top: 50px;
        display: block;
    }

    #skin-blur-white #echartsShow,
    #skin-blur-white #trackReport {
        width: 100%;
        display: none;
    }

    #skin-blur-white #trackReport {
        min-height: 550px;
    }

    #skin-blur-white #trackReport>div {
        min-height: 550px;
        padding: 5px;
        height: 100%;
    }

    #skin-blur-white #trackReport>div>div {
        width: 100%;
    }

    .articleTable {
        height: 100%!important;
    }

    #skin-blur-white {
        color: #666!important;
    }

    table {
        width: 100%;
    }

    #data-header-table {
        background-color: #fff;
    }
    /*#data-header-table tr{
            border:1px solid red;
          }*/

    .num {
        min-width: 50px;
        max-width: 50px;
        text-align: center;
    }

    .titleTd {
        text-overflow: ellipsis;
        /* for IE */
        -moz-text-overflow: ellipsis;
        /* for Firefox,mozilla */
        overflow: hidden;
        white-space: nowrap;
        max-width: 130px;
        min-width: 60px;
    }

    .channelTd {
        text-overflow: ellipsis;
        /* for IE */
        -moz-text-overflow: ellipsis;
        /* for Firefox,mozilla */
        overflow: hidden;
        white-space: nowrap;
        max-width: 45px;
    }

    .timeTd {
        text-overflow: ellipsis;
        /* for IE */
        -moz-text-overflow: ellipsis;
        /* for Firefox,mozilla */
        overflow: hidden;
        white-space: nowrap;
        max-width: 60px;
    }

    .tableTitle th {
        font-weight: 400;
        color: #435f76;
    }

    th,
    td {
        padding: 5px;
    }

    .mediaTable,
    .articleTable,
    #trackEcharts {
        border: 1px solid #ddd;
        border-radius: 5px!important;
    }

    #trackEcharts {
        margin-top: 5px;
        /*min-height: 350px;*/
    }

    .mediaTable .tableBody {
        max-height: 200px;
        overflow: auto;
    }

    .tableBody {
        overflow: auto;
    }

    .tableTitle {
        border-bottom: 1px solid #ddd;
    }

    .tableBody tr:nth-child(odd) td {
        background-color: #eaeaea;
    }

     ::-webkit-scrollbar {
        width: 5px;
    }

     ::-webkit-scrollbar:window-inactive {
        width: 0px;
    }

    .tl-timeaxis-tick-text,
    .tl-timeaxis-timesuffix {
        color: #666!important;
    }

    .table>thead>tr>th {
        padding: 5px 8px;
        background-color: #fff;
    }

    table.dataTable.no-footer,
    .dataTables_wrapper.no-footer .dataTables_scrollBody {
        border-bottom: 1px solid #ddd;
    }

    .nowrapTd {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis !important;
    }

    .table>thead>tr>th {
        padding-left: 0px;
        padding-right: 0px;
    }
    </style>
</head>

<body class="no-scroll" style="background-color: rgba(255, 255, 255, 0);" id="skin-blur-white" style="overflow: auto;">
    <section id="main" class="p-relative" role="main">
        <!-- Content -->
        <section id="content" class="container">
            <div id="contentDiv">
                <div class="titleDiv">
                    <p>传播链分析</p>
                </div>
                <div id="timeline" style="width: 100%;"></div>
                <div id="trackReport" class="container">
                    <div class="col-md-4">
                        <div class="mediaTable">
                            <table class="tableTitle">
                                <tr>
                                    <th>媒体名称</th>
                                    <th class="num">文章数</th>
                                    <th class="num">阅读数</th>
                                    <th class="num">点赞数</th>
                                    <th class="num">评论数</th>
                                </tr>
                            </table>
                            <div class="tableBody">
                                <table>
                                </table>
                            </div>
                        </div>
                        <div id="trackEcharts"></div>
                    </div>
                    <div class="col-md-8">
                        <div class="articleTable">
                            <table class="table table-striped table-hover" id="userList" width="100%">
                                <thead>
                                    <tr>
                                        <th style="width: 100px;" class="text-center">文章标题</th>
                                        <th style="width: 50px;" class="text-center">发表时间</th>
                                        <th class="text-center">出处</th>
                                        <th class="text-center">热度</th>
                                        <th class="text-center">转发数</th>
                                        <th class="text-center">点赞数</th>
                                        <th class="text-center">阅读数</th>
                                        <th class="text-center">评论数</th>
                                        <th class="text-center">收藏数</th>
                                        <th class="text-center">事件性质</th>
                                        <!-- <th>文章标题</th>
                                <th>发表时间</th>
                                <th>出处</th>
                                <th>热度</th>
                                <th>转发数</th>
                                <th>点赞数</th>
                                <th>阅读数</th>
                                <th>评论数</th>
                                <th>收藏数</th> -->
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
                <div id="echartsShow"></div>
            </div>
        </section>
    </section>
    <!-- Javascript Libraries -->
    <!-- jQuery -->
    <script src="{$webroot}assets/js/jquery.min.js"></script>
    <!-- jQuery Library -->
    <script src="{$webroot}assets/js/jquery-ui.min.js"></script>
    <!-- jQuery UI -->
    <!-- Bootstrap -->
    <script src="{$webroot}assets/js/bootstrap.min.js"></script>
    <script src="{$webroot}assets/js/resize.js"></script>
    <!-- UX -->
    <script src="{$webroot}assets/js/scroll.min.js"></script>
    <!-- Custom Scrollbar -->
    <script src="{$webroot}assets/js/echarts.min.js"></script>
    <script src="{$webroot}assets/js/dark.js"></script>
    <script src="{$webroot}assets/js/timeline-min.js"></script>
    <script src="{$webroot}assets/js/jquery.dataTables.min.js"></script>
    <!-- datatables -->
    <!-- All JS functions -->
    <script type="text/javascript">
    var in_array = function(arr) {
        // 遍历是否在数组中
        for (var i = 0, k = arr.length; i < k; i++) {
            if (this == arr[i]) {
                return true;
            }
        }

        // 如果不在数组中就会返回false
        return false;
    }

    // 给字符串添加原型
    String.prototype.in_array = in_array;
    // 给数字类型添加原型
    Number.prototype.in_array = in_array;

    var os = null;

    $(document).ready(function() {
        os = getOs();
        pageResize();
        /*showTimeline();*/
        choose();

        $(".tableTitle").each(function() {
            var length;
            length = $(this).siblings(".tableBody").find("tr").eq(0).find("td").length;

            for (var i = 0; i < length; i++) {
                $(this).find("th").eq(i).width($(this).siblings(".tableBody").find("tr").eq(0).find("td").eq(i).width());
            }

        })

        $(".articleTableBody").height($(".articleTable").height() - $(".articleTableTitle").height() - $(".table-responsive").height() - 3);

        $("#timeline").height($("#contentDiv").height() - $(".titleDiv").height());

        var id = "{$id}";
        var postData = {};
        postData.event_id = id;
        $.ajax({
            url: '/media/api_get_transmission',
            type: 'post',
            dataType: 'json',
            data: postData,
            success: function(result) {
                var json = {};
                json.scale = "human";
                json.events = [];
                for (var i = 0; i < result.length; i++) {
                    json.events[i] = {};
                    json.events[i].start_date = {};
                    json.events[i].text = {};

                    var time = result[i].publish_datetime;
                    var year = time.split(' ')[0].split('-')[0];
                    var month = time.split(' ')[0].split('-')[1];
                    var day = time.split(' ')[0].split('-')[2];
                    var hour = time.split(' ')[1].split(':')[0];
                    var minute = time.split(' ')[1].split(':')[1];
                    var second = time.split(' ')[1].split(':')[2];
                    json.events[i].start_date.year = year;
                    json.events[i].start_date.month = month;
                    json.events[i].start_date.day = day;
                    json.events[i].start_date.hour = hour;
                    json.events[i].start_date.minute = minute;
                    json.events[i].start_date.second = second;
                    json.events[i].text.headline = result[i].chi;
                    json.events[i].text.text = "<p class='title'>" + result[i].title + "</p><p class='content'>" + result[i].content + "</p><a href='http://" + result[i].channel + "'  target='_blank'>新闻链接</a>"
                }
                timeline = new TL.Timeline('timeline', json);

            }
        })

    });
    $(window).resize(function() {
        var dataModel = "{$choosename}";
        switch (dataModel) {
            case 'chain':
                {
                    $("#echartsShow").hide();
                    $("#trackReport").hide();
                    $("#timeline").show();
                    $(".titleDiv p").html("传播链分析");
                    $("#timeline").height($("#contentDiv").height() - $(".titleDiv").height());

                    var id = "{$id}";
                    var postData = {};
                    postData.event_id = id;
                    $.ajax({
                        url: '/media/api_get_transmission',
                        type: 'post',
                        dataType: 'json',
                        data: postData,
                        success: function(result) {
                            var json = {};
                            json.scale = "human";
                            json.events = [];
                            for (var i = 0; i < result.length; i++) {
                                json.events[i] = {};
                                json.events[i].start_date = {};
                                json.events[i].text = {};

                                var time = result[i].publish_datetime;
                                var year = time.split(' ')[0].split('-')[0];
                                var month = time.split(' ')[0].split('-')[1];
                                var day = time.split(' ')[0].split('-')[2];
                                var hour = time.split(' ')[1].split(':')[0];
                                var minute = time.split(' ')[1].split(':')[1];
                                var second = time.split(' ')[1].split(':')[2];
                                json.events[i].start_date.year = year;
                                json.events[i].start_date.month = month;
                                json.events[i].start_date.day = day;
                                json.events[i].start_date.hour = hour;
                                json.events[i].start_date.minute = minute;
                                json.events[i].start_date.second = second;
                                json.events[i].text.headline = result[i].chi;
                                json.events[i].text.text = "<p class='title'>" + result[i].title + "</p><p class='content'>" + result[i].content + "</p><a href='http://" + result[i].channel + "'  target='_blank'>新闻链接</a>"
                            }
                            timeline = new TL.Timeline('timeline', json);

                        }
                    })

                    break;
                }
            case 'trackReport':
                {
                    $("#timeline").hide();
                    $("#echartsShow").hide();
                    $("#trackReport").show();
                    $(".titleDiv p").html("追踪报道");
                    $("#trackReport").height($("#contentDiv").height() - $(".titleDiv").height());
                    $("#trackEcharts").height($("#trackReport").find(".col-md-5").height() - $(".mediaTable").height() - 20);
                    var id = "{$id}";
                    var postData = {};
                    postData.event_id = id;
                    /*alert(id);*/

                    $.ajax({
                        url: '/media/api_get_follow',
                        type: 'post',
                        dataType: 'json',
                        data: postData,
                        success: function(result) {
                            /*console.log(result);*/
                            $("#trackEcharts").height($("#trackReport").height() - $(".mediaTable").height() - 20);
                            //整理数据
                            var sinaData = [];
                            var zhihuData = [];
                            var wangyiData = [];
                            var ifengData = [];
                            var rmData = [];
                            var tyData = [];
                            var weiboData = [];
                            var tecentData = [];
                            var weChatData = [];
                            for (var i = 0; i < result.articleRank.length; i++) {
                                var arr = [];
                                arr[0] = result.articleRank[i].publish_datetime;
                                arr[1] = result.articleRank[i].heat;
                                arr[2] = result.articleRank[i].author_name;
                                arr[3] = result.articleRank[i].title;
                                switch (result.articleRank[i].channel) {
                                    case '新浪微博':
                                        {
                                            weiboData.push(arr);
                                            break;
                                        }
                                    case '知乎':
                                        {
                                            zhihuData.push(arr);
                                            break;
                                        }
                                    case '网易新闻':
                                        {
                                            wangyiData.push(arr);
                                            break;
                                        }
                                    case '凤凰网':
                                        {
                                            ifengData.push(arr);
                                            break;
                                        }
                                    case '人民网':
                                        {
                                            rmData.push(arr);
                                            break;
                                        }
                                    case '天涯论坛':
                                        {
                                            tyData.push(arr);
                                            break;
                                        }
                                    case '新浪新闻':
                                        {
                                            sinaData.push(arr);
                                            break;
                                        }
                                    case '腾讯新闻':
                                        {
                                            tecentData.push(arr);
                                            break;
                                        }
                                    case '微信':
                                        {
                                            weChatData.push(arr);
                                            break;
                                        }
                                }
                            }

                            trackEcharts(sinaData, zhihuData, wangyiData, ifengData, rmData, tyData, weiboData, tecentData, weChatData);

                            //文章表格

                            $(".dataTables_scrollBody").height($(".articleTable").height() - 80);
                        }
                    })


                    break;
                }
            case 'eventFavor':
                {
                    $("#timeline").hide();
                    $("#trackReport").hide();
                    $("#echartsShow").show();
                    $(".titleDiv p").html("友好度分析");
                    $("#echartsShow").height($("#contentDiv").height() - $(".titleDiv").height());
                    favorEcharts();
                    break;
                }
            default:
                {
                    break;
                }
        }

    })
    var pageResize = function() {
        var cWidth = document.documentElement.clientWidth;
        var cHeight = document.documentElement.clientHeight;
        if (cWidth < 992) {
            if (os == "MSIE") window.scrollTo(0, 0);
        }
        // needScroll(cWidth, cHeight);
        fixTableHeader(cWidth, cHeight);
        // setHeight(cHeight);


    };


    var fixTableHeader = function(cWidth, cHeight) {
        var isSmall = false;
        if (cWidth < 992) {
            isSmall = true;
        }
        if (os == "iPad") return;

        if (isSmall) {
            $("#content").height("auto");

        } else {
            $("#content").height(cHeight);

        }


    };

    var nextStep = function(i) {
        switch (i) {
            case 1:
                $("#model-setting-li").tab('show');
                break;
            case 2:
                $("#model-result-li").tab('show');
                break;
        }
    };


    var getOs = function() {
        var OsObject = "";
        if (navigator.userAgent.indexOf("iPad") > 0) {
            return "iPad";
        }
        if (navigator.userAgent.indexOf("Chrome/") > 0) {
            return "Chrome";
        }
        if (navigator.userAgent.indexOf("MSIE") > 0 || navigator.userAgent.indexOf(".NET") > 0) {
            return "MSIE";
        }
        if (navigator.userAgent.indexOf("Firefox") > 0) {
            return "Firefox";
        }
        if (navigator.userAgent.indexOf("Safari") > 0) {
            return "Safari";
        }
        if (navigator.userAgent.indexOf("Camino") > 0) {
            return "Camino";
        }
        if (navigator.userAgent.indexOf("Gecko/") > 0) {
            return "Gecko";
        }

    };

    var maxPage;

    function choose() {
        var dataModel = "{$choosename}";
        /* alert(dataModel);*/
        switch (dataModel) {
            case 'chain':
                {
                    $("#echartsShow").hide();
                    $("#trackReport").hide();
                    $("#timeline").show();
                    $(".titleDiv p").html("传播链分析");
                    $("#timeline").height($("#contentDiv").height() - $(".titleDiv").height());

                    var id = "{$id}";
                    var postData = {};
                    postData.event_id = id;
                    $.ajax({
                        url: '/media/api_get_transmission',
                        type: 'post',
                        dataType: 'json',
                        data: postData,
                        success: function(result) {
                            var json = {};
                            json.scale = "human";
                            json.events = [];
                            for (var i = 0; i < result.length; i++) {
                                json.events[i] = {};
                                json.events[i].start_date = {};
                                json.events[i].text = {};

                                var time = result[i].start_datetime;
                                var year = time.split(' ')[0].split('-')[0];
                                var month = time.split(' ')[0].split('-')[1];
                                var day = time.split(' ')[0].split('-')[2];
                                var hour = time.split(' ')[1].split(':')[0];
                                var minute = time.split(' ')[1].split(':')[1];
                                var second = time.split(' ')[1].split(':')[2];
                                json.events[i].start_date.year = year;
                                json.events[i].start_date.month = month;
                                json.events[i].start_date.day = day;
                                json.events[i].start_date.hour = hour;
                                json.events[i].start_date.minute = minute;
                                json.events[i].start_date.second = second;
                                json.events[i].text.headline = result[i].chi;
                                json.events[i].text.text = "<p class='title'>" + result[i].title + "</p><p class='content'>" + result[i].content + "</p><a href='http://" + result[i].channel + "'  target='_blank'>新闻链接</a>"
                            }
                            timeline = new TL.Timeline('timeline', json);

                        }
                    })

                    break;
                }
            case 'trackReport':
                {
                    $("#timeline").hide();
                    $("#echartsShow").hide();
                    $("#trackReport").show();
                    $(".titleDiv p").html("追踪报道");
                    $("#trackReport").height($("#contentDiv").height() - $(".titleDiv").height());
                    $("#trackEcharts").height($("#trackReport").find(".col-md-5").height() - $(".mediaTable").height() - 20);
                    var id = "{$id}";
                    var postData = {};
                    postData.event_id = id;
                    /*alert(id);*/

                    $.ajax({
                        url: '/media/api_get_follow',
                        type: 'post',
                        dataType: 'json',
                        data: postData,
                        success: function(result) {
                            console.log(result);
                            console.log(result.article_nature);
                            maxPage = result.articleRank.length;
                            var str = "";
                            for (var i = 0; i < result.channelRank.length; i++) {
                                str += '<tr><td>' + result.channelRank[i].channel + '</td><td class="num">';
                                if (result.channelRank[i].original_total == -1) {
                                    str += '-</td><td class="num">';
                                } else {
                                    str += result.channelRank[i].original_total + '</td><td class="num">';
                                }
                                if (result.channelRank[i].read_total == -1) {
                                    str += '-</td><td class="num">';
                                } else {
                                    str += result.channelRank[i].read_total + '</td><td class="num">';
                                }
                                if (result.channelRank[i].like_total == -1) {
                                    str += '-</td><td class="num">';
                                } else {
                                    str += result.channelRank[i].like_total + '</td><td class="num">';
                                }
                                if (result.channelRank[i].reply_total == -1) {
                                    str += '-</td></tr>';
                                } else {
                                    str += result.channelRank[i].reply_total + '</td></tr>';
                                }
                            }
                            //事件性质判断
                            // var events="";
                            // for(var i=0;i<result.article_nature.length;i++){
                            //    if(article_nature[i]=="position"){
                            //             events+="正面";
                            //       }else if(article_nature[i]=="neutral"){
                            //              events+="中性";
                            //       }else{
                            //         events+="负面";
                            //       }
                            // }
                            $(".mediaTable .tableBody table").empty();
                            $(".mediaTable .tableBody table").append(str);
                            $("#trackEcharts").height($("#trackReport").height() - $(".mediaTable").height() - 20);
                            //整理数据
                            var sinaData = [];
                            var zhihuData = [];
                            var wangyiData = [];
                            var ifengData = [];
                            var rmData = [];
                            var tyData = [];
                            var weiboData = [];
                            var tecentData = [];
                            var weChatData = [];
                            //判断事件性质
                            // var article_nature=[];
                            for (var i = 0; i < result.articleRank.length; i++) {
                                var arr = [];
                                arr[0] = result.articleRank[i].publish_datetime;
                                arr[1] = result.articleRank[i].heat;
                                arr[2] = result.articleRank[i].author_name;
                                arr[3] = result.articleRank[i].title;
                                // 判断事件性质【4】
                                // arr[4]=result.articleRank[i].article_nature;
                                switch (result.articleRank[i].channel) {
                                    case '新浪微博':
                                        {
                                            weiboData.push(arr);
                                            break;
                                        }
                                    case '知乎':
                                        {
                                            zhihuData.push(arr);
                                            break;
                                        }
                                    case '网易新闻':
                                        {
                                            wangyiData.push(arr);
                                            break;
                                        }
                                    case '凤凰网':
                                        {
                                            ifengData.push(arr);
                                            break;
                                        }
                                    case '人民网':
                                        {
                                            rmData.push(arr);
                                            break;
                                        }
                                    case '天涯论坛':
                                        {
                                            tyData.push(arr);
                                            break;
                                        }
                                    case '新浪新闻':
                                        {
                                            sinaData.push(arr);
                                            break;
                                        }
                                    case '腾讯新闻':
                                        {
                                            tecentData.push(arr);
                                            break;
                                        }
                                    case '微信':
                                        {
                                            weChatData.push(arr);
                                            break;
                                        }

                                }
                                //    var article_nature=['position',"neutral","negative"];
                                //    for(var i=0;i<result.article_nature.length;i++){
                                //     if(article_nature=="position"){
                                //           return "正面";
                                //     }else if(article_nature=="neutral"){
                                //             return "中性";
                                //     }else{
                                //       return "负面";
                                //     }

                                // }
                            }

                            trackEcharts(sinaData, zhihuData, wangyiData, ifengData, rmData, tyData, weiboData, tecentData, weChatData);
                            // 事件性质数据整理
                            //  var position=[];
                            // var neutral=[];
                            // var negative=[];
                            // for(var i=0;i<result.article_nature.length;i++){
                            //   var=
                            // }
                            //文章表格
                            $("#userList").dataTable({
                                "bLengthChange": false, //改变每页显示数据数量
                                "bFilter": false, //过滤功能
                                /*"bSort": true,*/
                                "bProcessing": true,
                                "aoColumnDefs": [{ "bSortable": false, "aTargets": [0, 2] }],
                                "order": [
                                    [3, 'desc']
                                ],

                                "iDisplayLength": 50,
                                "bInfo": false,
                                "sScrollY": function() {
                                    var bodyHeight = $(".articleTable").height();
                                    return bodyHeight - 70;
                                }(),
                                "createdRow": function(row, data, dataIndex) {
                                    /*$(row).children('td').eq(0).attr('style', 'width: 100px;text-align:center;');
                                    $(row).children('td').eq(1).attr('style', 'width: 50px;text-align:center;');*/
                                    $(row).children('td').eq(2).attr('style', 'text-align:center;');
                                    $(row).children('td').eq(3).attr('style', 'text-align:center;');
                                    $(row).children('td').eq(4).attr('style', 'text-align:center;');
                                    $(row).children('td').eq(5).attr('style', 'text-align:center;');
                                    $(row).children('td').eq(6).attr('style', 'text-align:center;');
                                    $(row).children('td').eq(7).attr('style', 'text-align:center;');
                                    $(row).children('td').eq(8).attr('style', 'text-align:center;');

                                },
                                data: result.articleRank,
                                columns: [{
                                        'data': 'title',
                                        "createdCell": function(td, cellData, rowData, row, col) {
                                            var text = $(td).html();
                                            var elementText = '<p class="nowrapTd" style="width:100px;margin:0px;" title="' + text + '">' + text + '</p>';
                                            $(td).html('').html(elementText);
                                        },
                                    },
                                    {
                                        'data': 'publish_datetime',
                                        "createdCell": function(td, cellData, rowData, row, col) {
                                            var text = $(td).html();
                                            var elementText = '<p class="nowrapTd" style="width:50px;margin:0px;" title="' + text + '">' + text + '</p>';
                                            $(td).html('').html(elementText);
                                        },
                                    },
                                    { 'data': 'channel'
                                        /*,"createdCell": function (td, cellData, rowData, row, col) {
                                                                                                            var text=$(td).html();
                                                                                                            var elementText='<p class="nowrapTd" style="width:50px;margin:0px;" title="'+text+'">'+text+'</p>';
                                                                                                            $(td).html('').html(elementText);
                                                                                                        },*/
                                    },
                                    { 'data': 'heat' },
                                    { 'data': 'forward_count' },
                                    { 'data': 'like_count' },
                                    { 'data': 'read_count' },
                                    { 'data': 'reply_count' },
                                    { 'data': 'collect_count' },
                                    {
                                        'data': 'article_nature',
                                        "render": function(arg1, arg2, arg3) {
                                            if (arg1 == "positive") return "负面";
                                            else if (arg1 == "neutral") return "中性";
                                            else {
                                                return "负面"
                                            }
                                            return "arg1";
                                        }
                                    }
                                ]
                            })
                        }
                    })


                    break;
                }
            case 'eventFavor':
                {
                    $("#timeline").hide();
                    $("#trackReport").hide();
                    $("#echartsShow").show();
                    $(".titleDiv p").html("友好度分析");
                    $("#echartsShow").height($("#contentDiv").height() - $(".titleDiv").height());
                    favorEcharts();
                    break;
                }
            default:
                {
                    break;
                }
        }
    }


    //追踪报道
    function trackEcharts(sinaData, zhihuData, wangyiData, ifengData, rmData, tyData, weiboData, tecentData, weChatData) {
        var track = echarts.init(document.getElementById('trackEcharts'));

        /*var weChatData=[["2017-6-1 15:37:04",240.8,'刘恋',240.8]];
        var tyData=[['2017-4-12 15:31:00',9.4,'PY思考者',9.4],['2017-4-16 19:29:00',7.8,'lyron_',7.8]];
        var wangyiData=[['2017-01-06 18:45:00',10,'中国新闻网',10],['2017-01-06 22:57:00',2,'央广网',2],['2017-01-07 07:31:17',32,'南方日报',32],['2017-01-07 18:54:00',12,'澎湃新闻网',12],['2017-01-13 01:06:35',32,'新快报',32],['2017-01-13 06:14:46',12,'南方都市报',12],['2017-01-13 17:11:06',12,'信息时报',12],['2017-04-10 08:54:01',32,'南方日报',32],['2017-04-11 16:16:00',12,'中国新闻网',12],['2017-04-12 08:05:00',6,'广州日报',6],['2017-04-14 09:00:00',8,'澎湃新闻网',8],['2017-04-15 01:29:29',43,'新京报',43],['2017-04-16 02:40:21',54,'信息时报',54],['2017-04-22 10:24:00',54,'央广网',54],['2017-05-03 01:13:40',3.4,'新京报',3.4],['2017-05-04 09:46:00',4,'金羊网',4]];
        var ifengData=[['2017-01-06 18:45:00',0,'中国新闻网',0],['2017-01-06 22:57:00',0,'央广网',0],['2017-01-07 10:33:00',0,'人民网',0],['2017-01-10 12:07:00',0,'央广网',0],['2017-01-13 10:13:00',0,'新快报',0],['2017-01-13 10:24:00',0,'信息时报',0],['2017-04-14 09:00:00',0,'澎湃新闻网',0],['2017-04-15 02:38:52',0,'新京报',0],['2017-04-19 20:17:44',0,'消费日报',0],['2017-04-19 16:13:00',0,'消费日报网',0],['2017-04-19 16:13:00',0,'消费日报网',0],['2017-04-22 21:29:01',0,'央广网',0],['2017-05-03 00:00:00',0,'新京报',0],['2017-05-03 19:16:28',0,'新京报',0],['2017-05-17 19:32:42',0,'第一财经',0]];
        var qqData=[['2017-01-07 19:32:00',0,'澎湃新闻',0],['2017-04-15 03:15:00',4.6,'新京报',4.6]];
        var sinaData=[['2017-03-24 11:53:00',0,'中山大学',0],['2017-04-11 16:16:00',0.2,'中国新闻网',0.2]];
        var zhihuData=[['2017-05-07 13:12:55',2.4,'匿名用户',2.4],['2017-04-08 23:09:57',9.6,'月底人',9.6],['2017-04-08 23:19:21',12.8,'doc.yang',12.8],['2017-04-09 03:08:17',6.6,'匿名用户',6.6],['2017-04-09 06:49:30',1.4,'野猫菌',1.4],['2017-04-09 12:12:29',0.2,'匿名用户',0.2],['2017-04-09 23:30:47',1.8,'匿名用户',1.8],['2017-04-10 09:22:47',0.2,'匿名用户',0.2],['2017-04-10 09:54:50',3.6,'把子',3.6],['2017-04-10 11:16:20',2.2,'夏栗言',2.2],['2017-04-10 13:49:20',0.6,'匿名用户',0.6],['2017-04-10 17:26:42',1.6,'喵喵',1.6],['2017-04-10 17:58:43',0.8,'Ray Lu',0.8],['2017-04-10 19:14:59',0.2,'匿名用户',0.2],['2017-04-10 19:35:20',2.4,'Grande',2.4],['2017-04-10 19:42:16',9.6,'匿名用户',9.6],['2017-04-10 22:10:55',0.4,'匿名用户',0.4],['2017-04-10 22:14:04',2,'罗皓文',2],['2017-04-10 22:49:18',19.4,'匿名用户',19.4]];*/
        option = {
            tooltip: {
                trigger: 'item',
            },
            dataZoom: {
                show: true,
                /*startValue:'2017-2-2',
                endValue:'2017-5-18'*/
            },
            legend: {
                data: ['新浪微博', '微信', '天涯论坛', '网易新闻', '凤凰网', '腾讯新闻', '新浪新闻', '知乎', '人民网'],
                itemGap: 5
            },
            grid: {
                y2: 80,
                x: 50,
                x2: 70,
                y: 70
            },
            xAxis: [{
                type: 'time',
                splitNumber: 10,
                splitLine: {
                    lineStyle: {
                        color: "#ddd"
                    }
                },
                scale: true,
                name: "发布时间"
            }],
            yAxis: [{
                type: 'value',
                name: '热度值',
                splitLine: {
                    lineStyle: {
                        color: "#ddd"
                    }
                },
                scale: true
            }],
            animation: false,
            series: [{
                    name: '网易新闻',
                    type: 'scatter',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            var str = '';
                            str += params.value[0] + "</br>";
                            str += params.seriesName + "-" + params.value[2] + ":" + params.value[3] + "</br>";
                            str += "热度:" + params.value[1];
                            return str;

                        },
                        position: function(p) { //其中p为当前鼠标的位置
                            return [p[0] + 10, p[1] - 10];
                        },
                    },

                    data: wangyiData

                },
                {
                    name: '微信',
                    type: 'scatter',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            var str = '';
                            str += params.value[0] + "</br>";
                            str += params.seriesName + "-" + params.value[2] + ":" + params.value[3] + "</br>";
                            str += "热度:" + params.value[1];
                            return str;

                        },
                        position: function(p) { //其中p为当前鼠标的位置
                            return [p[0] + 10, p[1] - 10];
                        },
                    },

                    data: weChatData
                },
                {
                    name: '天涯论坛',
                    type: 'scatter',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            var str = '';
                            str += params.value[0] + "</br>";
                            str += params.seriesName + "-" + params.value[2] + ":" + params.value[3] + "</br>";
                            str += "热度:" + params.value[1];
                            return str;

                        },
                        position: function(p) { //其中p为当前鼠标的位置
                            return [p[0] + 10, p[1] - 10];
                        },
                    },

                    data: tyData
                },

                {
                    name: '凤凰网',
                    type: 'scatter',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            var str = '';
                            str += params.value[0] + "</br>";
                            str += params.seriesName + "-" + params.value[2] + ":" + params.value[3] + "</br>";
                            str += "热度:" + params.value[1];
                            return str;

                        },
                        position: function(p) { //其中p为当前鼠标的位置
                            return [p[0] + 10, p[1] - 10];
                        },

                    },

                    data: ifengData
                },
                {
                    name: '腾讯新闻',
                    type: 'scatter',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            var str = '';
                            str += params.value[0] + "</br>";
                            str += params.seriesName + "-" + params.value[2] + ":" + params.value[3] + "</br>";
                            str += "热度:" + params.value[1];
                            return str;

                        },
                        position: function(p) { //其中p为当前鼠标的位置
                            return [p[0] + 10, p[1] - 10];
                        },
                    },

                    data: tecentData
                },
                {
                    name: '新浪新闻',
                    type: 'scatter',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            var str = '';
                            str += params.value[0] + "</br>";
                            str += params.seriesName + "-" + params.value[2] + ":" + params.value[3] + "</br>";
                            str += "热度:" + params.value[1];
                            return str;

                        },
                        position: function(p) { //其中p为当前鼠标的位置
                            return [p[0] + 10, p[1] - 10];
                        },
                    },

                    data: sinaData
                },
                {
                    name: '知乎',
                    type: 'scatter',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            var str = '';
                            str += params.value[0] + "</br>";
                            str += params.seriesName + "-" + params.value[2] + ":" + params.value[3] + "</br>";
                            str += "热度:" + params.value[1];
                            return str;

                        },
                        position: function(p) { //其中p为当前鼠标的位置
                            return [p[0] + 10, p[1] - 10];
                        },
                    },

                    data: zhihuData
                },
                {
                    name: '新浪微博',
                    type: 'scatter',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            var str = '';
                            str += params.value[0] + "</br>";
                            str += params.seriesName + "-" + params.value[2] + ":" + params.value[3] + "</br>";
                            str += "热度:" + params.value[1];
                            return str;

                        },
                        position: function(p) { //其中p为当前鼠标的位置
                            return [p[0] + 10, p[1] - 10];
                        },
                    },

                    data: weiboData
                },
                {
                    name: '人民网',
                    type: 'scatter',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            var str = '';
                            str += params.value[0] + "</br>";
                            str += params.seriesName + "-" + params.value[2] + ":" + params.value[3] + "</br>";
                            str += "热度:" + params.value[1];
                            return str;

                        },
                        position: function(p) { //其中p为当前鼠标的位置
                            return [p[0] + 10, p[1] - 10];
                        },
                    },

                    data: rmData
                }
            ]
        };
        track.setOption(option);
        /*track.on('click', function (param){
                    window.open(param.value[3]);
                }); 
*/
    }

    //单个事件媒体友好度分析
    function favorEcharts() {
        var favor = echarts.init(document.getElementById('echartsShow'));
        var zhL = [14, 12];
        var weChatL = [23, 21];
        var sinaL = [34, 32];
        var wyL = [8, 42];
        var rmL = [22, 23];
        var tyL = [31, 26];
        var fhL = [19, 12];
        var wbL = [2, 2];
        var tecentL = [32, 32];
        var baiduL = [45, 3];

        var id = "{$id}";
        var postData = {};
        postData.event_id = id;
        /*alert(id);*/

        var seriesItem = function(opts){
          /**
            opts = {
              name:"",
              data:[]
            }
          **/

          return  {
                    name: opts.name,
                    type: 'scatter',
                    symbolSize: function(value) {
                        return value[1];

                    },
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                position: 'top',
                                distance: zhL * 5,
                                formatter: function(params) {
                                    return params.seriesName + "-" + " 友好度:" + params.data[0] + "," + "影响值：" + params.data[1];
                                },
                                textStyle: {
                                    fontSize: 18,
                                    fontWeight: 600
                                }
                            },

                        }

                    },
                    /*formatter:'{a}',*/
                    data: [opts.data]
                };
        }

        $.ajax({
            url: '/media/api_get_friendly',
            type: 'post',
            dataType: 'json',
            data: postData,
            success: function(result) {

                console.log(result);
                var seriesDatas = [];
                var legend = [];
                for( var k in result ){
                   legend.push( result[k].channel );
                   
                   var item = new seriesItem({
                    name: result[k].channel,
                    data: [ result[k].friendly,result[k].influnce]
                   });

                   seriesDatas.push( item );
                }
                console.log(seriesDatas);

                 option = {
                    legend: {
                        data: legend,
                        textStyle: {
                            fontSize: 18,
                        }
                    },
                    grid: {
                        x: 20
                    },
                    xAxis: [{
                        type: 'value',
                        name: '媒体友好值',
                        splitNumber: 4,
                        scale: true,
                        splitLine: {
                            show: false
                        },
                        min: -100,
                        max: 100,
                        nameTextStyle: {
                            fontSize: 16,
                        }
                    }],
                    yAxis: [{
                        type: 'value',
                        // splitNumber: 4,
                        scale: true,
                        name: '影响值',
                        splitLine: {
                            show: false
                        },
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            show: false
                        },
                        min:0,
                        max: 100,
                        nameTextStyle: {
                            fontSize: 16,
                        }
                    }],
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            var res = '';
                            for (var i = 0, l = params.length; i < l; i++) {
                                res += params[i].seriesName + ' : ' + params[i].data[0];
                            }
                            return res;
                        }
                    },
                    series: seriesDatas
                  }

              favor.setOption(option);
            }
        });
    }
    </script>
</body>

</html>